# Name of the workflow, displayed in the GitHub Actions tab
name: 'PlayStation SDK and Folder Protection'

# Trigger: This workflow runs on every pull request targeting the main branch
on:
  pull_request:
    branches: [ master ]

jobs:
  code-guardian:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    steps:
      # Step 1: Get a list of all files changed in the PR
      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v44
        with:
          files: |
            **/*

      # Step 2: Check for files from the PlayStation SDK
      - name: Check for PlayStation SDK Files
        if: ${{ steps.changed-files.outputs.any_changed == 'true' }}
        run: |
          echo "Checking for proprietary PlayStation SDK files..."
          
          # --- !!! IMPORTANT: CUSTOMIZE THIS LIST FOR YOUR PROJECT !!! ---
          # Add patterns that match the PlayStation SDK files in your repository.
          # The patterns below are common examples.
          SDK_PATTERNS=(
            # --- Block entire SDK directories ---
            # Adjust these paths to match your project structure.
            "ThirdParty/PS5/**"
            "ThirdParty/Sony/**"
            "Plugins/PlayStation5/**"
            "Platforms/PS5/**"
            "Sony/**"

            # --- Block specific file types common to PlayStation SDKs ---
            "*.prx"
            "*.sprx"

            # --- Block library files, often prefixed with 'sce' ---
            # This is a very effective way to catch many SDK files.
            "**/libSce*.a"
            "**/libSce*.lib"
            
            # --- (Use with caution) Block ANY file with 'sce' in the name ---
            # This is very broad and might catch files you did not intend to.
            # Only enable it if you are sure it won't cause issues.
            # "**/*sce*/**" 
          )
          
          # Loop through each changed file
          for file in ${{ steps.changed-files.outputs.all_changed_files }}; do
            # Loop through each SDK pattern
            for pattern in "${SDK_PATTERNS[@]}"; do
              if [[ "$file" == $pattern ]]; then
                echo "ERROR: A PlayStation SDK file was detected in this Pull Request."
                echo "The file '$file' matches the forbidden pattern '$pattern'."
                echo "Proprietary SDK files cannot be committed to this repository."
                exit 1 # Exit with an error code, failing the check
              fi
            done
          done

          echo "Success: No PlayStation SDK files were detected."
